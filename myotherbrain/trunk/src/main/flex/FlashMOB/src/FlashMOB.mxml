<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:item="item.*">
    <mx:RemoteObject id="mobSession" destination="flashmobsession">
    	<mx:method name="getItems" result="queryHandler(event)"/>
    </mx:RemoteObject>
    <mx:Script>
    	<![CDATA[
    		import mx.collections.ArrayCollection;
    		import mx.rpc.events.ResultEvent;
    		import mx.controls.Alert;
    		import Item;
    		import ExamplePOJO;
    		//import item.ItemVBox;
    		import CreateFirstClassItem;
    	
    		import mx.collections.ArrayCollection;
    		//[Bindable]
    		//private var myData:ArrayCollection;
    		private function queryHandler(event:ResultEvent):void {
    			var queryResult:ArrayCollection = event.result as ArrayCollection;
    			//Alert.show("queryResult.length = " + queryResult.length);
    			//Alert.show("before: " + queryResult.getItemAt(0));
    			for (var i:int = 0; i < queryResult.length; i++) {
    				var it:Item = queryResult.getItemAt(i) as Item;
    				var b:ItemVBox = new ItemVBox();
    				b.setItem(it);
    				this.columnVBox.addChild(b);
    			}
    			//Alert.show("it = " + it);			
    		}
    		
    		private function testMOBCommunication():void {
    			Alert.show("testing");
    			
    			mobSession.getVersionInfo();
    			
    			mobSession.arbitraryString();
    			mobSession.arbitraryFloat();
    		    mobSession.arbitraryDate();
    		    mobSession.arbitraryURI();
    		    mobSession.arbitraryExamplePOJO();
    			
    			// TODO: investigate precision issues in passed numbers
    			// TODO: investigate passing of URIs
    			// TODO: investigate exception handling
    			// TODO: investigate encoding issues in passed strings
    			
    			var s:String = "passed string";
    			var f:Number = 1.4142;
    			var d:Date = new Date();
   				//...
   				var p:ExamplePOJO = new ExamplePOJO();
   				p.name = "green";
   				p.description = "a pleasant color";
   				mobSession.passString(s);
   				mobSession.passFloat(f);
   				mobSession.passDate(d);
   				//...
   				mobSession.passExamplePOJO(p);
   				
   				/*
   				var action:CreateFirstClassItem = new CreateFirstClassItem();
   				action.subject = "http://example.org/stuff/fordPrefect";
   				action.name = "Ford Prefect";
   				action.description = "an odd man from a small planet somewhere in the vicinity of Betelgeuse";
   				action.emphasis = 0.75;
   				action.creationTimeStamp = new Date();
   				mobSession.enqueueAction(action);
   				//*/
   				
   				var it:Item = new Item();
   				it.name = "Julius Caesar";
   				it.description = "a Roman emperor";
   				this.testItem.setItem(it);
   				
   				mobSession.getItems();
    		}
    	]]>
    </mx:Script>
    <item:ItemVBox id="testItem"/>
	<mx:Button label="Click to talk to MOB!" click="testMOBCommunication()"/>
	<mx:Label text="{mobSession.getVersionInfo.lastResult}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.arbitraryString.lastResult}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.arbitraryFloat.lastResult}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.arbitraryDate.lastResult}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.arbitraryURI.lastResult}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.arbitraryExamplePOJO.lastResult.toString()}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.passString.lastResult}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.passFloat.lastResult}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.passDate.lastResult}" fontSize="14" fontWeight="bold"/>
	<mx:Label text="{mobSession.passExamplePOJO.lastResult.toString()}" fontSize="14" fontWeight="bold"/>
    <mx:VBox id="columnVBox"/>
</mx:Application>
